<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>LoopModel.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">sandbox_coverage</a> &gt; <a href="../index.html" class="el_bundle">sandbox-functional-converter-core</a> &gt; <a href="index.source.html" class="el_package">org.sandbox.functional.core.model</a> &gt; <span class="el_source">LoopModel.java</span></div><h1>LoopModel.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * Copyright (c) 2026 Carsten Hammer.
 *
 * This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License 2.0
 * which accompanies this distribution, and is available at
 * https://www.eclipse.org/legal/epl-2.0/
 *
 * SPDX-License-Identifier: EPL-2.0
 *
 * Contributors:
 *     Carsten Hammer
 *******************************************************************************/
package org.sandbox.functional.core.model;

import java.util.ArrayList;
import java.util.Collections;
import java.util.List;
import org.sandbox.functional.core.operation.Operation;
import org.sandbox.functional.core.terminal.TerminalOperation;

/**
 * Unified Loop Representation (ULR) model.
 * 
 * &lt;p&gt;This class provides an AST-independent representation of loop structures
 * that can be transformed into functional/stream-based equivalents.&lt;/p&gt;
 * 
 * &lt;p&gt;The model consists of three main components:&lt;/p&gt;
 * &lt;ul&gt;
 * &lt;li&gt;{@link SourceDescriptor} - describes what is being iterated over&lt;/li&gt;
 * &lt;li&gt;{@link ElementDescriptor} - describes the loop variable&lt;/li&gt;
 * &lt;li&gt;{@link LoopMetadata} - describes loop characteristics and constraints&lt;/li&gt;
 * &lt;/ul&gt;
 * 
 * @see &lt;a href=&quot;https://github.com/carstenartur/sandbox/issues/450&quot;&gt;Issue #450&lt;/a&gt;
 * @since 1.0.0
 */
public class LoopModel {
	
	private SourceDescriptor source;
	private ElementDescriptor element;
	private LoopMetadata metadata;
<span class="fc" id="L43">	private final List&lt;Operation&gt; operations = new ArrayList&lt;&gt;();</span>
	private TerminalOperation terminal;
	
	/**
	 * Default constructor.
	 */
<span class="fc" id="L49">	public LoopModel() {</span>
<span class="fc" id="L50">	}</span>
	
	/**
	 * Creates a new LoopModel.
	 * 
	 * @param source the source descriptor
	 * @param element the element descriptor
	 * @param metadata the loop metadata
	 */
<span class="fc" id="L59">	public LoopModel(SourceDescriptor source, ElementDescriptor element, LoopMetadata metadata) {</span>
<span class="fc" id="L60">		this.source = source;</span>
<span class="fc" id="L61">		this.element = element;</span>
<span class="fc" id="L62">		this.metadata = metadata;</span>
<span class="fc" id="L63">	}</span>
	
	/**
	 * Gets the source descriptor.
	 * 
	 * @return the source descriptor
	 */
	public SourceDescriptor getSource() {
<span class="fc" id="L71">		return source;</span>
	}
	
	/**
	 * Gets the element descriptor.
	 * 
	 * @return the element descriptor
	 */
	public ElementDescriptor getElement() {
<span class="fc" id="L80">		return element;</span>
	}
	
	/**
	 * Gets the loop metadata.
	 * 
	 * @return the loop metadata
	 */
	public LoopMetadata getMetadata() {
<span class="fc" id="L89">		return metadata;</span>
	}
	
	/**
	 * Gets an unmodifiable view of the operations list.
	 * 
	 * @return an unmodifiable list of operations
	 */
	public List&lt;Operation&gt; getOperations() { 
<span class="fc" id="L98">		return Collections.unmodifiableList(operations); </span>
	}
	
	/**
	 * Gets the terminal operation.
	 * 
	 * @return the terminal operation
	 */
	public TerminalOperation getTerminal() { 
<span class="fc" id="L107">		return terminal; </span>
	}
	
	/**
	 * Sets the terminal operation.
	 * 
	 * @param terminal the terminal operation
	 */
	public void setTerminal(TerminalOperation terminal) {
<span class="fc" id="L116">		this.terminal = terminal;</span>
<span class="fc" id="L117">	}</span>
	
	// Package-private setters for internal model construction and testing.
	// Note: LoopModelBuilder in org.sandbox.functional.core.builder uses the public constructor instead.
	LoopModel setSource(SourceDescriptor source) {
<span class="fc" id="L122">		this.source = source;</span>
<span class="fc" id="L123">		return this;</span>
	}
	
	LoopModel setElement(ElementDescriptor element) {
<span class="fc" id="L127">		this.element = element;</span>
<span class="fc" id="L128">		return this;</span>
	}
	
	LoopModel setMetadata(LoopMetadata metadata) {
<span class="fc" id="L132">		this.metadata = metadata;</span>
<span class="fc" id="L133">		return this;</span>
	}
	
	/**
	 * Adds an operation to the pipeline.
	 * 
	 * @param op the operation to add, must not be {@code null}
	 * @return this LoopModel for fluent API
	 * @throws NullPointerException if op is {@code null}
	 */
	public LoopModel addOperation(Operation op) {
<span class="fc" id="L144">		java.util.Objects.requireNonNull(op, &quot;operation must not be null&quot;);</span>
<span class="fc" id="L145">		this.operations.add(op);</span>
<span class="fc" id="L146">		return this;</span>
	}
	
	/**
	 * Sets the terminal operation (fluent API).
	 * 
	 * @param terminal the terminal operation, must not be {@code null}
	 * @return this LoopModel for fluent API
	 * @throws NullPointerException if terminal is {@code null}
	 */
	public LoopModel withTerminal(TerminalOperation terminal) {
<span class="fc" id="L157">		java.util.Objects.requireNonNull(terminal, &quot;terminal operation must not be null&quot;);</span>
<span class="fc" id="L158">		this.terminal = terminal;</span>
<span class="fc" id="L159">		return this;</span>
	}
	
	/**
	 * Checks if this model can be converted to a stream.
	 */
	public boolean isConvertible() {
<span class="fc bfc" id="L166" title="All 2 branches covered.">		if (metadata == null) return true;</span>
<span class="fc" id="L167">		return metadata.isConvertible();</span>
	}
	
	/**
	 * Returns a string representation of this loop model.
	 * 
	 * @return string representation
	 */
	@Override
	public String toString() {
<span class="fc" id="L177">		return &quot;LoopModel[source=&quot; + source + &quot;, element=&quot; + element </span>
				+ &quot;, metadata=&quot; + metadata + &quot;, operations=&quot; + operations
				+ &quot;, terminal=&quot; + terminal + &quot;]&quot;;
	}
	
	@Override
	public boolean equals(Object obj) {
<span class="pc bpc" id="L184" title="1 of 2 branches missed.">		if (this == obj) {</span>
<span class="nc" id="L185">			return true;</span>
		}
<span class="pc bpc" id="L187" title="2 of 4 branches missed.">		if (obj == null || getClass() != obj.getClass()) {</span>
<span class="nc" id="L188">			return false;</span>
		}
<span class="fc" id="L190">		LoopModel other = (LoopModel) obj;</span>
<span class="pc bpc" id="L191" title="1 of 2 branches missed.">		return java.util.Objects.equals(source, other.source)</span>
<span class="pc bpc" id="L192" title="1 of 2 branches missed.">				&amp;&amp; java.util.Objects.equals(element, other.element)</span>
<span class="pc bpc" id="L193" title="1 of 2 branches missed.">				&amp;&amp; java.util.Objects.equals(metadata, other.metadata)</span>
<span class="pc bpc" id="L194" title="1 of 2 branches missed.">				&amp;&amp; java.util.Objects.equals(operations, other.operations)</span>
<span class="pc bpc" id="L195" title="1 of 2 branches missed.">				&amp;&amp; java.util.Objects.equals(terminal, other.terminal);</span>
	}
	
	@Override
	public int hashCode() {
<span class="fc" id="L200">		return java.util.Objects.hash(source, element, metadata, operations, terminal);</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>