<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>CheckNodeForValidReferences.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">sandbox_coverage</a> &gt; <a href="../index.html" class="el_bundle">sandbox_tools</a> &gt; <a href="index.source.html" class="el_package">org.sandbox.jdt.internal.corext.fix.helper</a> &gt; <span class="el_source">CheckNodeForValidReferences.java</span></div><h1>CheckNodeForValidReferences.java</h1><pre class="source lang-java linenums">package org.sandbox.jdt.internal.corext.fix.helper;

import java.util.Iterator;

import org.eclipse.jdt.core.dom.ASTNode;
import org.eclipse.jdt.core.dom.ASTVisitor;
import org.eclipse.jdt.core.dom.CastExpression;
import org.eclipse.jdt.core.dom.Expression;
import org.eclipse.jdt.core.dom.FieldAccess;
import org.eclipse.jdt.core.dom.IBinding;
import org.eclipse.jdt.core.dom.IMethodBinding;
import org.eclipse.jdt.core.dom.ITypeBinding;
import org.eclipse.jdt.core.dom.IVariableBinding;
import org.eclipse.jdt.core.dom.MethodInvocation;
import org.eclipse.jdt.core.dom.Name;
import org.eclipse.jdt.core.dom.SimpleName;
import org.eclipse.jdt.core.dom.SuperFieldAccess;
import org.eclipse.jdt.core.dom.Type;
import org.eclipse.jdt.internal.corext.dom.AbortSearchException;
import org.eclipse.jdt.internal.corext.dom.ASTNodes;

class CheckNodeForValidReferences {
<span class="nc" id="L23">	private static final String ITERATOR_NAME= Iterator.class.getCanonicalName();</span>

	private final ASTNode fASTNode;
	private final boolean fLocalVarsOnly;

<span class="nc" id="L28">	public CheckNodeForValidReferences(ASTNode node, boolean localVarsOnly) {</span>
<span class="nc" id="L29">		fASTNode= node;</span>
<span class="nc" id="L30">		fLocalVarsOnly= localVarsOnly;</span>
<span class="nc" id="L31">	}</span>

	public boolean isValid() {
<span class="nc" id="L34">		ASTVisitor visitor= new ASTVisitor() {</span>

			@Override
			public boolean visit(FieldAccess visitedField) {
<span class="nc" id="L38">				IVariableBinding binding= visitedField.resolveFieldBinding();</span>
<span class="nc bnc" id="L39" title="All 2 branches missed.">				if (binding == null) {</span>
<span class="nc" id="L40">					throw new AbortSearchException();</span>
				}
<span class="nc bnc" id="L42" title="All 4 branches missed.">				if (fLocalVarsOnly &amp;&amp; visitedField.getLocationInParent() == MethodInvocation.EXPRESSION_PROPERTY) {</span>
<span class="nc" id="L43">					MethodInvocation methodInvocation= ASTNodes.getParent(visitedField, MethodInvocation.class);</span>
<span class="nc" id="L44">					IMethodBinding methodInvocationBinding= methodInvocation.resolveMethodBinding();</span>
<span class="nc bnc" id="L45" title="All 2 branches missed.">					if (methodInvocationBinding == null) {</span>
<span class="nc" id="L46">						throw new AbortSearchException();</span>
					}
<span class="nc" id="L48">					ITypeBinding methodTypeBinding= methodInvocationBinding.getReturnType();</span>
<span class="nc bnc" id="L49" title="All 2 branches missed.">					if (AbstractTool.isOfType(methodTypeBinding, ITERATOR_NAME)) {</span>
<span class="nc" id="L50">						throw new AbortSearchException();</span>
					}
				}
<span class="nc" id="L53">				return true;</span>
			}

			@Override
			public boolean visit(SuperFieldAccess visitedField) {
<span class="nc" id="L58">				IVariableBinding binding= visitedField.resolveFieldBinding();</span>
<span class="nc bnc" id="L59" title="All 2 branches missed.">				if (binding == null) {</span>
<span class="nc" id="L60">					throw new AbortSearchException();</span>
				}
<span class="nc bnc" id="L62" title="All 4 branches missed.">				if (fLocalVarsOnly &amp;&amp; visitedField.getLocationInParent() == MethodInvocation.EXPRESSION_PROPERTY) {</span>
<span class="nc" id="L63">					MethodInvocation methodInvocation= ASTNodes.getParent(visitedField, MethodInvocation.class);</span>
<span class="nc" id="L64">					IMethodBinding methodInvocationBinding= methodInvocation.resolveMethodBinding();</span>
<span class="nc bnc" id="L65" title="All 2 branches missed.">					if (methodInvocationBinding == null) {</span>
<span class="nc" id="L66">						throw new AbortSearchException();</span>
					}
<span class="nc" id="L68">					ITypeBinding methodTypeBinding= methodInvocationBinding.getReturnType();</span>
<span class="nc bnc" id="L69" title="All 2 branches missed.">					if (AbstractTool.isOfType(methodTypeBinding, ITERATOR_NAME)) {</span>
<span class="nc" id="L70">						throw new AbortSearchException();</span>
					}
				}
<span class="nc" id="L73">				return true;</span>
			}

			@Override
			public boolean visit(MethodInvocation methodInvocation) {
<span class="nc bnc" id="L78" title="All 2 branches missed.">				if (fLocalVarsOnly) {</span>
<span class="nc" id="L79">					IMethodBinding methodInvocationBinding= methodInvocation.resolveMethodBinding();</span>
<span class="nc bnc" id="L80" title="All 2 branches missed.">					if (methodInvocationBinding == null) {</span>
<span class="nc" id="L81">						throw new AbortSearchException();</span>
					}
<span class="nc" id="L83">					ITypeBinding methodTypeBinding= methodInvocationBinding.getReturnType();</span>
<span class="nc bnc" id="L84" title="All 2 branches missed.">					if (AbstractTool.isOfType(methodTypeBinding, ITERATOR_NAME)) {</span>
<span class="nc" id="L85">						Expression exp= methodInvocation.getExpression();</span>
<span class="nc bnc" id="L86" title="All 2 branches missed.">						if (exp instanceof SimpleName) {</span>
<span class="nc" id="L87">							IBinding binding= ((SimpleName) exp).resolveBinding();</span>
<span class="nc bnc" id="L88" title="All 4 branches missed.">							if (binding instanceof IVariableBinding &amp;&amp; !((IVariableBinding) binding).isField()</span>
<span class="nc bnc" id="L89" title="All 2 branches missed.">									&amp;&amp; !((IVariableBinding) binding).isParameter()</span>
<span class="nc bnc" id="L90" title="All 2 branches missed.">									&amp;&amp; !((IVariableBinding) binding).isRecordComponent()) {</span>
<span class="nc" id="L91">								ITypeBinding typeBinding= ((IVariableBinding) binding).getType();</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">								if (AbstractTool.isOfType(typeBinding, ITERATOR_NAME)) {</span>
<span class="nc" id="L93">									return true;</span>
								}
							}
						}
<span class="nc" id="L97">						throw new AbortSearchException();</span>
					}
				}
<span class="nc" id="L100">				return true;</span>
			}

			@Override
			public boolean visit(CastExpression castExpression) {
<span class="nc" id="L105">				Type castType= castExpression.getType();</span>
<span class="nc" id="L106">				ITypeBinding typeBinding= castType.resolveBinding();</span>
<span class="nc bnc" id="L107" title="All 2 branches missed.">				if (AbstractTool.isOfType(typeBinding, ITERATOR_NAME)) {</span>
<span class="nc" id="L108">					Expression exp= castExpression.getExpression();</span>
<span class="nc bnc" id="L109" title="All 2 branches missed.">					if (exp instanceof Name) {</span>
<span class="nc" id="L110">						IBinding binding= ((Name) exp).resolveBinding();</span>
<span class="nc bnc" id="L111" title="All 2 branches missed.">						if (binding instanceof IVariableBinding simpleNameVarBinding) {</span>
<span class="nc bnc" id="L112" title="All 2 branches missed.">							if (!fLocalVarsOnly) {</span>
<span class="nc bnc" id="L113" title="All 4 branches missed.">								if (!simpleNameVarBinding.isField() &amp;&amp; !simpleNameVarBinding.isParameter()</span>
<span class="nc bnc" id="L114" title="All 2 branches missed.">										&amp;&amp; !simpleNameVarBinding.isRecordComponent()) {</span>
<span class="nc" id="L115">									throw new AbortSearchException();</span>
								}
							} else {
<span class="nc bnc" id="L118" title="All 4 branches missed.">								if (simpleNameVarBinding.isField() || simpleNameVarBinding.isParameter()</span>
<span class="nc bnc" id="L119" title="All 2 branches missed.">										|| simpleNameVarBinding.isRecordComponent()) {</span>
<span class="nc" id="L120">									throw new AbortSearchException();</span>
								}
							}
						}
					}
<span class="nc" id="L125">					throw new AbortSearchException();</span>
				}
<span class="nc" id="L127">				return true;</span>
			}

			@Override
			public boolean visit(SimpleName simpleName) {
<span class="nc" id="L132">				IBinding simpleNameBinding= simpleName.resolveBinding();</span>
<span class="nc bnc" id="L133" title="All 2 branches missed.">				if (simpleNameBinding == null) {</span>
<span class="nc" id="L134">					throw new AbortSearchException();</span>
				}
<span class="nc bnc" id="L136" title="All 2 branches missed.">				if (simpleNameBinding instanceof IVariableBinding simpleNameVarBinding) {</span>
<span class="nc" id="L137">					ITypeBinding simpleNameTypeBinding= simpleNameVarBinding.getType();</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">					if (AbstractTool.isOfType(simpleNameTypeBinding, ITERATOR_NAME)) {</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">						if (simpleName.getLocationInParent() == MethodInvocation.EXPRESSION_PROPERTY) {</span>
<span class="nc" id="L140">							MethodInvocation methodInvocation= ASTNodes.getParent(simpleName, MethodInvocation.class);</span>
<span class="nc" id="L141">							IMethodBinding methodInvocationBinding= methodInvocation.resolveMethodBinding();</span>
<span class="nc bnc" id="L142" title="All 2 branches missed.">							if (methodInvocationBinding == null) {</span>
<span class="nc" id="L143">								throw new AbortSearchException();</span>
							}
<span class="nc" id="L145">							ITypeBinding methodInvocationReturnType= methodInvocationBinding.getReturnType();</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">							if (!AbstractTool.isOfType(methodInvocationReturnType, ITERATOR_NAME)) {</span>
<span class="nc" id="L147">								return true;</span>
							}
						}
<span class="nc bnc" id="L150" title="All 2 branches missed.">						if (!fLocalVarsOnly) {</span>
<span class="nc bnc" id="L151" title="All 4 branches missed.">							if (!simpleNameVarBinding.isField() &amp;&amp; !simpleNameVarBinding.isParameter()</span>
<span class="nc bnc" id="L152" title="All 2 branches missed.">									&amp;&amp; !simpleNameVarBinding.isRecordComponent()) {</span>
<span class="nc" id="L153">								throw new AbortSearchException();</span>
							}
<span class="nc bnc" id="L155" title="All 4 branches missed.">						} else if (simpleNameVarBinding.isField() || simpleNameVarBinding.isParameter()</span>
<span class="nc bnc" id="L156" title="All 2 branches missed.">								|| simpleNameVarBinding.isRecordComponent()) {</span>
<span class="nc" id="L157">							throw new AbortSearchException();</span>
						}
					}
				}
<span class="nc" id="L161">				return true;</span>
			}
		};
		try {
<span class="nc" id="L165">			fASTNode.accept(visitor);</span>
<span class="nc" id="L166">			return true;</span>
<span class="nc" id="L167">		} catch (AbortSearchException e) {</span>
			// do nothing and fall through
		}
<span class="nc" id="L170">		return false;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>